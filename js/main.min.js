function doAutocomplete(e){lastAutocomplete=e,$.ajax({url:"./php/autocomplete.php",data:{term:e.toLowerCase()}}).done(function(a){a&&-1!=a&&(a=a.toLowerCase(),autocompleteCache[e]=a,lastAutocomplete==e&&$(".cached").val(a))})}function doSearch(e){function a(e){if(e&&-1!=e){try{e=JSON.parse(e)}catch(a){}searchCache[e.name.toLowerCase()]=e;for(var t in e.legalities)e.legalities[t]?$("#"+t+" span:first-child").removeClass("glyphicon-remove").addClass("glyphicon-ok"):$("#"+t+" span:first-child").removeClass("glyphicon-ok").addClass("glyphicon-remove"),$("#legalities").fadeIn()}else(e&&-1==e||!e)&&($(".term").val(""),$(".cached").val('"ach! hans, run!"'),flicker(".cached"),$(".term").focus())}e in searchCache?a(searchCache[e]):$.ajax({url:"./php/search.php",data:{term:e.toLowerCase()}}).done(a)}function flicker(e){$(e).animate({backgroundColor:"#df6868"},150,function(){$(this).animate({backgroundColor:"#FFF"},300)})}var autocompleteCache={},searchCache={},lastAutocomplete="";$(".term").focus(),$("#go").on("mousedown",function(){$(".term").val().length>0&&doSearch($(".term").val())}),$(".search .term").on("keydown",function(e){function a(){$(t).val().length>0&&doSearch($(t).val())}var t=this;switch(e.which){case 9:return e.preventDefault(),$(this).val($(".cached").val()),void doAutocomplete($(this).val());case 13:return e.preventDefault(),void a();case 39:return void($(".cached").val().length!=$(this).val().length&&($(this).val($(".cached").val()),doAutocomplete($(this).val())));case 27:return e.preventDefault(),$(".term").val(""),void $(".cached").val('"ach! hans, run!"')}var c=String.fromCharCode(e.which),o=c.search(/[a-zA-Z0-9/]/i)>-1,l=c.search(/[ ,.!"'&#/]/i)>-1,h=8==e.which;if(o||h||l){$("#legalities").fadeOut(),o&&(c=c.toLowerCase()),"7"==c&&e.shiftKey&&(c="&"),"1"==c&&e.shiftKey&&(c="!"),"3"==c&&e.shiftKey&&(c="#");var r=o||l?$(this).val()+c:$(this).val();if(h&&(r=r.substring(0,r.length-1)),r in autocompleteCache)return void $(".cached").val(autocompleteCache[r]);if(r.length>0){var n=$(".cached").val();n.length>r.length&&n.substring(r.length-1,r.length)!=c&&$(".cached").val(""),doAutocomplete(r)}else $(".cached").val("")}});